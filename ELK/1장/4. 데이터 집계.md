# 집계 API
과거에는 통계 작업을 위해 루씬이 제공하는 패싯(Facets) 기능을 많이 활용했다.  
패싯 기능은 기본적으로 디스크 기반으로 동작했고, 분산 환경에는 최적화되지 않았기 때문에 대용량 데이터의 통계 작업에는 적합하지 않았다.  
이로 인해 많은 장애가 발생하여 5.0 이상 버전은 독자적인 집계 API를 내놓았다.  
집계 API는 기본적으로 메모리 기반으로 동작하기 때문에 대용량의 데이터 통계 작업이 가능해졌다.
## 데이터 집계
[예제](실행예제/문서%20집계.http)를 실행 후 집계 결과를 살펴보면 버킷(Buckets)이라는 구조 안에 그룹화된 데이터가 포함돼 있다.  
엘라스틱 서치가 강력한 이유는 버킷 안에 다른 버킷의 결과를 추출할 수 있기 때문이다.
[예제2](실행예제/문서%20집계.http)를 확인해보면 장르별 국가 형태를 중첩해서 보여주는 집계의 예다.
### 데이터 집계 타입
집계 기능은 현재 4가지 API로 제공된다.  
집계 기능은 서로 조합해 사용이 가능하며, 이를 조합해서 매우 강력한 기능을 제공할 수 있다.  
1. 버킷집계  
집계 중 가장 많이 사용되며, 문서의 필드를 기준으로 버킷을 집계한다.
2. 메트릭 집계  
문서에서 추출된 값을 가지고 Sum, Max, Min, Avg를 계산한다.
3. 매트릭스 집계  
행렬의 값을 합하거나 곱한다.
4. 파이프라인 집계  
버킷에서 도출된 결과 문서를 다른 필드 값으로 재분류한다.  
즉, 다른 집계에 의해 생성된 출력 결과를 다시 한번 집계한다.  
엘라스틱서치의 집계가 패싯보다 강력한 이유가 여기 있다.