# 관계형 데이터 베이스와 엘라스틱 서치의 차이점

|엘라스틱서치|관계형 데이터베이스|
|-----|-----------|
|인덱스(Index)|데이터베이스(Database)|
|샤드(Shard)|파티션(Partition)|
|타입(Type)|테이블(Table)|
|문서(Document)|행(Row)|
|필드(Field)|열(Column)|
|매핑(Mapping)|스키마(Schema)|
|Query DSL|SQL|

# 엘라스틱 서치의 기본적인 소개

6.0이하 버전에서는 하나의 인덱스 내부에 기능에 따라 데이터를 분류하고 여러 개의 타입을 만들어 사용이 가능했지만, 그 이후 버전에서는 _docs 하나의 타입만 사용이 가능하다.  
엘라스틱 서치는 하나의 행을 문서라고 부르며, 데이터베이스에서는 테이블의 한 행을 의미한다.  
엘라스틱서치의 매핑은 필드의 구조와 제약조건에 대한 명세를 설정을 말하며 이에 대응하는 관계형 데이터베이스의 개념을 스키마라 한다.  
관계형 데이터베이스의 인덱스와 엘라스틱서치의 인덱스는 완전 틀린 의미이다.  
엘라스틱서치는 기본적으로 HTTP를 통해 Json 형식의 Restful API를 이용한다.
  
|엘라스틱서치에서 사용하는 HTTP 메서드|기능|데이터베이스의 질의문법|
|-------------------|---------|----------|
|GET|데이터 조회|SELECT|
|PUT|데이터 생성,인덱스 생성|INSERT,CREATE|
|POST|인덱스 업데이트, 데이터 조회|INSERT,SELECT|
|DELETE|데이터 삭제|DELETE
|HEAD|인덱스의 정보 확인|-|

# 엘라스틱 서치가 강력한 이유
1. 오픈소스 검색엔진  
엘라스틱서치는 아파치 재단의 루씬을 기반으로 개발이 되어있는 오픈소스 검색엔진이다.  
오픈소스이므로 전 세계 많은 사람들이 사용을 하며 문제가 발생시 빠르게 해결이 된다.  
2. 전문검색  
대부분의 데이터베이스는 기본 쿼리 및 색인 구조의 한계로 인해 기본적인 텍스트 검색 기능만 제공한다.
엘라스틱 서치는 좀 더 고차원적인 전문 검색(Full Text)이 가능하다.
전문 검색이란 내용 전체를 색안해서 특정 단어가 포함된 문서를 검색하는 것을 말한다.
3. 통계분석  
비정형 로그 데이터를 수집하고 한곳에 모아 통계 분석을 할 수 있다.  
엘라스틱서치와 키바나를 연결하면 실시간으로 쌓이는 로그를 시각화하고 분석할 수 있다.
4. 스키마리스  
데이터베이스는 스키마라는 구조에 따라 데이터를 적합한 형태로 변경해서 저장하고 편리하다.  
반면 엘라스틱설치는 정형화되지 않은 다양한 형태의 문서도 자동으로 색인하고 검색할 수 있다.
5. RESTful API  
엘라스틱서치는 HTTP 기반의 RESTful API를 지원하고 요청뿐 아니라 응답에도 JSON 형식을 사용해 개발 언어, 운영체제, 시스템에 관계없이 모든 플랫폼에서도 이용 가능하다.
6. 멀티테넌시  
서로 상이한 인덱스일지라도 검색할 필드명만 같으면 여러 개의 인덱스를 한번에 조회할 수 있다.  
이를 이용해 멀티테넌시 기능을 제공할 수 있다.
7. Document-Oriented  
여러 계층의 데이터를 JSON 형식의 구조화된 문서로 인덱스에 저장할 수 있다.  
계층 구조로 문서도 한번의 쿼리로 쉽게 조회할 수 있다.
8. 역색인  
엘라스틱서치 또한 역색인을 지원한다.  
반면 MongoDB, 카산드라 같은 일반적인 NoSQL은 역색인을 지원하지 않는다.  
이는 다른 NoSQL 대비 엘라스틱 서치의 매우 큰 장점이다.

## 역색인 예제
1. 엘라스틱서치 예제
2. 검색엔진 예제
3. 검색엔진 역색인
4. 데이터베이스와 검색엔진

|단어|문서번호|
|----|----|
|엘라스틱서치|1|
|검색엔진|2,3,4|
|역색인|3|
|데이터베이스|4|
|예제|1,2|

검색엔진이라는 문자가 들어간것을 찾으면 2,3,4 번의 문서를 찾게 될것이다.
## 확장성과 가용성
10억 개의 문서를 색인할 경우 모든 문서를 색인하는 데 비용과 시간이 많이 들것이다.  
엘라스틱 서치를 분산 구성해서 확장한다면 대량의 문서를 좀 더 효율적으로 처리할 수있다.  
분산 환경에서 데이터는 샤드라는 작은 단위로 나뉘어 제공되며, 인덱스를 만들 때마다 샤드의 수를 조절할 수 있다.  
이를 통해 데이터의 종류와 성격에 따라 데이터를 분산해서 빠르게 처리할 수 있다.
# 엘라스틱 서치의 약점
1. 실시간이 아니다  
일반적으로 색인된 데이터는 통상적으로 1초 뒤에나 검색이 가능하다.
색인된 데이터는 내부적으로 커밋가 플러시 같은 복잡한 과정을 거치기 때문에 실시간이 아니다.  
엄밀히 따지자면 준 실시간이라고 할 수 있다.
2. 트랜젝션과 롤백 기능을 제공하지 않는다.  
엘라스틱서치는 기본적으로 분산 시스템으로 구성된다.  
전체적인 클러스터의 성능 향상을 위해 시스템적으로 비용 소모가 큰 롤백과 트랜젝션을 지원하지 않기 때문에 최악의 경우 데이터 손실의 위험이 있다.
3. 데이터의 업데이트를 제공하지 않는다.  
엘라스틱서치는 업데이트 명령이 요청될 경우 기존 문서를 삭제하고 변경된 내용으로 새로운 문서를 생성하는 방식을 사용한다.
# 노드의 종류
1. 마스터노드
- 클러스터를 관리한다.
- 노드 추가와 제거 같은 클러스터의 전반적인 관리를 담당한다.
2. 데이터 노드
- 실질적인 데이터를 저장한다.
- 검색과 통계 같은 데이터 관련 작업을 수행한다.
3. 코디네이팅 노드
- 사용자의 요청만 받아서 처리한다.
- 클러스터 관련 요청은 마스터 노드에 전달하고 데이터 관련 요청은 데이터 노드에 전달한다.
4. 인제스트 노드
- 문서의 전처리 작업을 담당한다.
- 인덱스 생성 전 문서의 형식을 다양하게 변경할 수 있다.
# API의 종류
엘라스틱서치는 RESTful 방식의 API를 제공하며, 이를 통해 JSON 기반으로 통신한다.  
엘라스틱서치는 기본적으로 HTTP 통신을 위해 9200번 포트를 사용한다.  
엘라스틱서치는 다음과 같은 주요 API를 제공한다.  
- 인덱스 관리 API(Indices API) : 인덱스 관리
- 문서 관리 API(Document API) : 문서의 추가/수정/삭제
- 검색 API(Search API) : 문서 조회
- 집계 API(Aggregation API) : 문서 통계

# Index VS Indices
색인은 데이터가 토큰화되어 저장된 자료구조를 의미하며, Index라는 단어를 번역한 것이다.  
엘라스틱서치에서는 인덱스라는 용어를 색인과 다른 의미로 사용된다.
- Index : 색인데이터
- Indexing : 색인하는 과정
- Indices : 매핑 정보를 저장하는 논리적인 데이터 공

# 스키마리스
문서를 색인하기 위해서는 기본적으로 인덱스를 생성하는 과정이 필요한데 인덱스를 생성하는 과정 없이 문서를 추가하더라도 문서가 색인되도록 지원하는 일종의 편의 기능이다.    
최초 문서가 색인될 때 인덱스의 존재 여부를 확인하고 만약 인덱스가 존재하지 않는다면 문서를 분석해서 문서가 색인될 수 있게 인덱스를 자동으로 생성한다.
(RDBMS에서 Insert할 경우 Create가 된다고 생각하자.)
## 스키마리스는 되도록 사용하지 말자 
스키마리스는 성능과 밀접한 연관이 있기 때문에 특수한 상황에서만 사용해야 한다.  
만약 스키마리스를 사용해야 한다면 데이터 구조 및 검색 방식을 확실히 이해해야 한다.
### 테스트해보기
[예제](실행예제/스키마리스%20생성예제.http)에서 만약 스키마(인덱스)가 없을경우 자동으로 생성이 될것이며, 2번을 실행할 경우 모든 필드가 text타입과 keyword 타입을 동시에 제공하는 멀티필드로 구성이된다.  
스키마리스를 사용하면은 필요없는 필드도 생성이되어 데이터 공간이 많이 낭비가 발생된다.  
그리고 기본적으로 text 타입의 Standard Analyzer를 사용하는 타입으로 정의가 된다.  
예를들어 "아버지가 방에 들어 가신다"의 문장을 토크나이징 되면은 "아버지가", "방에", "들어", "가신다." 로 되며 "아버지"로 검색시 작동이 되지 않는다.

  
